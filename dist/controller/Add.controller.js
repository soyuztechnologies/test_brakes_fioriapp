sap.ui.define(["tcs/fin/payroll/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Fragment"],function(e,t,o,r,s){"use strict";return e.extend("tcs.fin.payroll.controller.Add",{onInit:function(){this.oLocalData=new t;this.oLocalData.setData({productData:{PRODUCT_ID:"",TYPE_CODE:"PR",CATEGORY:"Notebooks",NAME:"",DESCRIPTION:"",SUPPLIER_ID:"0100000046",SUPPLIER_NAME:"SAP",PRICE:"",CURRENCY_CODE:"EUR",DIM_UNIT:"CM",PRODUCT_PIC_URL:"/sap/public/bc/NWDEMO_MODEL/IMAGES/PO-1000.jpg"}});this.getView().setModel(this.oLocalData,"local")},mode:"create",onEnter:function(e){var t=e.getParameter("value");var o=this.getView().getModel();var s=this;this.getView().setBusy(true);o.read("/ProductSet('"+t+"')",{success:function(e){s.oLocalData.setProperty("/productData",e);s.getView().setBusy(false);s.mode="update";s.getView().byId("idSave").setText("Update")},error:function(e){debugger;r.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message);s.getView().setBusy(false);s.mode="create";s.getView().byId("idSave").setText("Save")}})},onClear:function(){this.oLocalData.setProperty("/productData",{PRODUCT_ID:"",TYPE_CODE:"PR",CATEGORY:"Notebooks",NAME:"",DESCRIPTION:"",SUPPLIER_ID:"0100000046",SUPPLIER_NAME:"SAP",PRICE:"",CURRENCY_CODE:"EUR",DIM_UNIT:"CM",PRODUCT_PIC_URL:"/sap/public/bc/NWDEMO_MODEL/IMAGES/PO-1000.jpg"});this.getView().byId("idSave").setText("Create");this.mode="create";this.getView().byId("idSuppname").setText("")},onDelete:function(e){r.confirm("Do you really want to do this to me :( ?",{onClose:this._deleteProduct.bind(this)})},onMostExpensive:function(){var e=this.getView().getModel();var t=this;t.getView().setBusy(true);e.callFunction("/GetMostExpensiveProduct",{urlParameters:{I_CATEGORY:"Notebooks"},success:function(e){t.oLocalData.setProperty("/productData",e);t.getView().setBusy(false);t.mode="update";t.getView().byId("idSave").setText("Update")}})},supplierPopup:null,oField:null,onConfirmPopup:function(e){var t=e.getSource().getId();var o=e.getParameter("selectedItem");var r=o.getLabel();this.oField.setValue(r);this.getView().byId("idSuppname").setText(o.getValue())},onSupplierF4:function(e){this.oField=e.getSource();var t=this;if(this.supplierPopup===null){s.load({id:"supplier",name:"tcs.fin.payroll.fragments.popup",controller:this}).then(function(e){t.supplierPopup=e;t.supplierPopup.setTitle("Select Supplier");t.getView().addDependent(t.supplierPopup);t.supplierPopup.setMultiSelect(false);t.supplierPopup.bindAggregation("items",{path:"/SupplierSet",template:new sap.m.DisplayListItem({label:"{BP_ID}",value:"{COMPANY_NAME}"})});t.supplierPopup.open()})}else{this.supplierPopup.open()}},_deleteProduct:function(e){if(e==="OK"){var t=this.getView().byId("PID").getValue();var r=this.getView().getModel();var s=this;r.remove("/ProductSet('"+t+"')",{success:function(){o.show("OMG You hurt me");s.onClear()},error:function(){o.show("I love you, you saved me");s.onClear()}})}},onSave:function(){var e=this.oLocalData.getProperty("/productData");var t=this.getView().getModel();if(this.mode==="update"){t.update("/ProductSet('"+e.PRODUCT_ID+"')",e,{success:function(){o.show("Wow!! Update was success Amigo")},error:function(e){r.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message)}})}else{t.create("/ProductSet",e,{success:function(){o.show("Wow!! You made it Amigo")},error:function(e){r.error(JSON.parse(e.responseText).error.innererror.errordetails[0].message)}})}}})});